# Azure Blob Storage



## 1. Public Access to Azure Blob Storage - access it from local terminal

**Step 1:** Go to Azure Portal ---> Storage Accounts 

**Step 2:** Create storage Account ---> Select the Storage Account

 ![image](https://github.com/user-attachments/assets/f5a37ad9-9cf4-4d1d-a8b3-854fefe68022)

**Step 3:** Under Networking:
   
   - Select Public network access: Enable from all networks.

   ![image](https://github.com/user-attachments/assets/2d4725d2-d38d-4e0d-bcd1-7ccb2aa3353a)


**Step 4:** Under Datastorage  ----> Containers ----> create a container.

  ![image](https://github.com/user-attachments/assets/1eb24987-3774-4c78-ae0a-acc31c75c100)

**Step 5:** Check if anonymous is not private for public access

- Go to configuration ----> enable blob anonymous acess 

- Go to container ---> 3 dots ----> change access level ----> blob

![image](https://github.com/user-attachments/assets/c444db26-4daa-4e34-a9d4-071c07b66e13)

**Step 6:** Upload a blob

- Click created container
- Click upload
- Browse for files
- Select file that have to upload from local
- After uploading

![image](https://github.com/user-attachments/assets/b4407a9c-94bc-4e2d-9699-7f005535cb99)

**Step 7:** Click the file to get the URL

![image](https://github.com/user-attachments/assets/a434df01-034d-49ef-bc79-20825318ccc8)

**Step 8:** copy the URL and run in browser

![image](https://github.com/user-attachments/assets/13219fc7-cd2a-469a-8b65-974b39f2faef)

**Step 9:** From local terminal, use azcopy, curl to access:

- To list blob in the container
```
azcopy list 'https://<storage_account>.blob.core.windows.net/<container>?<SAS_TOKEN>'
```
![image](https://github.com/user-attachments/assets/95dfa576-dd68-4871-80aa-8a2dd8ac1f1f)

- To copy a file (blob) from Azure Blob Storage to local machine
```
azcopy cp "https://<your_storage_account_name>.blob.core.windows.net/<your_container_name>/<blob_name>" "<local_path>"
```
![image](https://github.com/user-attachments/assets/e834a279-00e1-4112-aba6-4aac6be2c7ce)

- To Download the blob
```
curl https://<storage_account>.blob.core.windows.net/<container>/<blob>
```
Eg:curl https://azurestorageaccountdemoo.blob.core.windows.net/container/file.txt

![image](https://github.com/user-attachments/assets/3513fe45-4ba0-4501-a214-62229be2d697)


# 2. Secure Access Using Service Endpoint

![image](https://github.com/user-attachments/assets/ea526e4a-d6aa-447d-8954-1b1439fbc357)


**Step 1:** Create resourse-group:rg-ranjitha

**Step 2:** Create NSG for two vm's connect to subnet level.

**Step 3 :** Create NAT for private-vm

**Step 4:** Create virtual network :v-net

**Step 5:** Create subnets

  - public subnet for public-vm -----> Attach NSG (allow from public)
  - private subnet for private-vm -----> enable private subnet ----> Attach NSG (Allow 98.70.34.28 to 10.0.1.4) ----> Attach NAT ----> **Select service endpoints**

    ![image](https://github.com/user-attachments/assets/a6953692-452b-4198-a986-f1692ea4afd2)

**Step 6:** Create virtual machine

  - Create Public-vm ---> Add public ip address
  - Create Private-vm ----> **public-ip address(none)**

**Step 7 :** Create Storage Account

 - Create storage Account : serviceendpointaccount
 - Create container : service-container
 - upload files from local.

   - In **Configuration** under settings ------> disable blob anonymous access

       ![image](https://github.com/user-attachments/assets/14bf4138-015c-4672-a587-8725995d6c6b)

    - In **Networking** ------> Enabled from selected virtual networks and IP addresses ----> virtual networks [ Add existing virtual network:: vnet -> subnet attached service endpoint(private-vm subnet)]            ---->  Add client ip address
   
     ![image](https://github.com/user-attachments/assets/a36fdf31-8c0a-4a20-872f-e16d39279053)

**Step 8:** Generate SAS token

  - Go to storage account

- Navigate to your blob inside the container

- Click the 3 dots (...) next to the file --> Generate SAS

- Choose permissions: Tick Read

- Set an expiry time (e.g., 1 day)

- Click Generate SAS token and URL

- Copy the Blob SAS URL (it looks like a long URL with ?sv=... at the end)

  ![image](https://github.com/user-attachments/assets/07449fa9-3c38-4fad-b03e-62a3a695efdb)

**Step 9:** Download file inside private vm from storage account

- SSH to public vm(ssh ranjitha@98.70.34.28)
- SSH to private-vm (ssh ranjitha@10.0.1.4)
```
curl "<your full SAS URL>" -o file.txt   (if file name saved as file.txt)
curl "<SAS URL>" -o screenshot.png       (if it is a image saved as screenshot.png)
```
```
cat file.txt
```
**Output**
![image](https://github.com/user-attachments/assets/b791eb7e-a690-4f70-9b05-8c2176f8fc96)


# 3. Secure Access Using Private Link

 ![image](https://github.com/user-attachments/assets/b6137990-d4ad-4e14-bec9-e87ed1bc994f)

 **Step 1:** Continur from above (Secure Access Using Service Endpoint)

**Step 2:** Create Private Endpoint

   - Go to Azure Portal ----> Click Storage Account

   - Under Networking ----> Private endpoint connections ---> Click + Private Endpoint

    - Fill:

       - Name : storage-privatelink

       - Region :Central India

       - Resource type: Microsoft.Storage/storageAccounts

       - Target sub-resource: blob

       - Under Virtual Network, choose VNet and Private Subnet

       - Choose Integrate with Private DNS Zone (recommended)

       - Click Create


C. Test Access from Private VM

    SSH into your Private VM (via Bastion or jumpbox)

    Access storage via private IP:

```
https://<storage-account-name>.blob.core.windows.net/<container-name>/<blob-name>?<sas-token>
```


![image](https://github.com/user-attachments/assets/4d9d93c7-65bc-49f9-a3c7-21f65bc23616)
